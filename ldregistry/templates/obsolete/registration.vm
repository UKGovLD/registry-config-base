## Generate the registration dialog
## Parameters:
##    $return the page to return to (or is that just referrer)
##    $register the relative URI of the target register

#parse("structure/_preamble.vm")

  <div class="row">
    <div class="col-md-10 col-md-offset-1 modal-page-panel">
    
      <div class="modal-page-head">
        <h3>Register in $register</h3>
        <h4>Choose registration option ...</h4>
      </div>

      <div class="modal-page-body">

        <ul class="nav nav-pills">
          <li><a href="#item-upload" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="right"
                 data-content="Register an entry by uploading an RDF file">Upload</a></li>
          <li><a href="#batch" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="bottom"
                 data-content="Register a collection of entries by uploading a bulk file">Upload batchfile</a></li>
          <li><a href="#batch-ref" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="bottom"
                 data-content="Register a collection of referenced entries by uploading a bulk file">Upload ref-batchfile</a></li>
          <li><a href="#register" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="bottom"
                 data-content="Create a new sub-register here">Subregister</a></li>
          <li><a href="#forward" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="bottom"
                 data-content="Specify child URI to forward elsewhere">Forward</a></li>
          <li><a href="#entry-form" data-toggle="pill" class="popinfo" data-trigger="hover" data-placement="bottom"
                 data-content="Create and register a new entity via a form">General entry form</a></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane" id="item-upload">
            <form class="ajax-form" action="$register" method="post" enctype="multipart/form-data" data-return="$return">
              <div class="form-group">
                <label>Choose file(s) to upload:</label>
                <input class="form-control" type="file" name="file" multiple />
              </div>
              <input type="hidden" name="action" value="register" />
              <button class="btn">Upload and register</button>
            </form>
            <div class="ajax-error"></div>
          </div>

          <div class="tab-pane" id="batch">
            <form class="ajax-form" action="$register?batch-managed" method="post" enctype="multipart/form-data" data-return="$return">
              <div class="form-group">
                <label>Choose a bulk file to upload:</label>
                <input class="form-control" type="file" name="file" multiple />
              </div>
              <input type="hidden" name="action" value="register" />
              <button class="btn">Upload and register</button>
            </form>
            <div class="ajax-error"></div>
          </div>

          <div class="tab-pane" id="batch-ref">
            <form class="ajax-form" action="$register?batch-referenced" method="post" enctype="multipart/form-data" data-return="$return">
              <div class="form-group">
                <label>Choose a bulk reference file to upload:</label>
                <input class="form-control" type="file" name="file" multiple />
              </div>
              <input type="hidden" name="action" value="register" />
              <button class="btn">Upload and register</button>
            </form>
            <div class="ajax-error"></div>
          </div>

          <div class="tab-pane" id="register">
            <div class="ajax-error"></div>
            #set($spec=$lib.reg.getResource("/system/form-templates/register"))
            #parse( "actions/_form-for.vm" )
          </div>

          <div class="tab-pane" id="forward">
            <div class="ajax-error"></div>
            #set($spec=$lib.reg.getResource("/system/form-templates/forward"))
            #parse( "actions/_form-for.vm" )
          </div>


          <div class="tab-pane" id="entry-form">
            <select class="form-control" id="form-chooser">
              <option>Choose a form:</option>
              #foreach($form in $lib.reg.listMembers("/system/form-templates"))
                #if(!$form.entityURI.endsWith("/forward") && !$form.entityURI.endsWith("/register"))
                  #set($label = $form.labels.iterator().next().lexicalForm)
                  <option data-target="#form-$label">$label</option>
                #end
              #end
            </select>
              #foreach($form in $lib.reg.listMembers("/system/form-templates"))
                #if(!$form.entityURI.endsWith("/forward") && !$form.entityURI.endsWith("/register"))
                  #set($label = $form.labels.iterator().next().lexicalForm)

                  <div class="hidden form-choice" id="form-$label">
                    #set($spec=$lib.reg.getResource($form.entityURI))
                    #parse( "actions/_form-for.vm" )
                    <div class="ajax-error"></div>
                  </div>

                #end
              #end
          </div>

          <div class="tab-pane" id="item">
            #set($spec=$lib.reg.getResource("/system/form-templates/concept"))
            #parse( "actions/_form-for.vm" )
            <div class="ajax-error"></div>
          </div>


        </div>
      </div>


      <div class="modal-page-footer">
        <a href="$return" class="btn pull-right">Close</a>
      </div>
      
    </div>
  </div>
  
</div>

<div class="modal-backdrop in"></div>

   <script type="text/javascript">
    $(function() {

       $("#form-chooser").change(function(event){
         $(".form-choice").each(function(){
           var form = $(this);
           if (!form.hasClass("hidden")) {
              form.addClass("hidden")
           }
         });
         var target = event.target;
         var option = target.options[target.selectedIndex];
         var form = $(option).attr('data-target');
         $(form).removeClass("hidden");
         return false;
       });
    });

   </script>

#parse("structure/_footer.vm")

